<html>
    <head>
        <script
            type="text/javascript"
            src="../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php


/**
 * Implements hook_libraries_info().
 */
function ma_gcs_libraries_info() {

	$libraries['c3'] = array(
			// Only used in administrative UI of Libraries API.
			'name' =&gt; 'C3',
			'vendor url' =&gt; 'http://c3js.org',
			'download url' =&gt; 'https://github.com/masayuki0812/c3/releases/latest',
			'files' =&gt; array(
					'js' =&gt; array('c3.min.js'),
					'css' =&gt; array('c3.min.css'),
			),
			'versions' =&gt; array(
					'0.4.10' =&gt; array(
							'files' =&gt; array(
									'js' =&gt; array('c3.min.js'),
									'css' =&gt; array('c3.min.css'),
							),
					),
			),
			'version' =&gt; '0.4.10',
			'dependencies' =&gt; array('d3'),
	);

	$libraries['d3'] = array(
			// Only used in administrative UI of Libraries API.
			'name' =&gt; 'D3',
			'vendor url' =&gt; 'http://d3js.org',
			'download url' =&gt; 'https://github.com/mbostock/d3',
			'files' =&gt; array(
					'js' =&gt; array('d3.min.js'),
			),
			'versions' =&gt; array(
					'3.5.0' =&gt; array(
							'files' =&gt; array(
									'js' =&gt; array('d3.min.js'),
							),
					),
			),
			'version' =&gt; '3.5.0',
	);

	return $libraries;
}

/**
 * Initialize the module
*/
function ma_gcs_init() {
	libraries_load('c3');
	libraries_load('d3');
	//drupal_add_js('https://www.google.com/jsapi', 'external');
	drupal_add_css(drupal_get_path('module', 'ma_gcs') .'/css/ma_gcs.css');
  drupal_add_js(drupal_get_path('module', 'ma_gcs') . '/js/ma_gcs.js');
}

/**
 * Define our shortcodes and their titles, descriptions, and callback functions
*/
function ma_gcs_menu() {
  $items = array();
  $items['admin/config/services/ma_gcs'] = array(
    'title' =&gt; 'Google Charts Shortcodes',
    'description' =&gt; 'Configuration for Google Charts Shortcodes',
    'page callback' =&gt; 'drupal_get_form',
    'page arguments' =&gt; array('ma_gcs_admin'),
    'access arguments' =&gt; array('administer site configuration'),
    'type' =&gt; MENU_NORMAL_ITEM,
    'file' =&gt; 'ma_gcs.admin.inc',
  );
  return $items;
}

function _ma_gcs_chart_types() {
//	Spline Chart, Step Chart, Area Chart, Bar Chart, Scatter Chart, Pie Chart, Donut Chart, Gauge Chart

	return array(
		'Pie' =&gt; 'piechart',
		'Bar' =&gt; 'barchart',
		'Line' =&gt; 'linechart',
	);
}

function ma_gcs_shortcode_info() {
	$chartarray=_ma_gcs_chart_types();
	foreach ($chartarray as $key =&gt; $value) {
		$shortcodes[&quot;$value&quot;] = array(
			'title' =&gt; (&quot;Google $key Chart&quot;),
			'description' =&gt; (&quot;Embed a Google $key Chart.&quot;),
			'attributes callback' =&gt; 'ma_gcs_shortcode_' . $value . '_attributes',
			'process callback' =&gt; 'ma_gcs_shortcode_' . $value . '',
			'tips callback' =&gt; 'ma_gcs_shortcode_' . $value . '_tip'
		);
	}
	return $shortcodes;
}
/**
 * Attributes form element for random Shortcode.
 *
 * Used by shortcode_wysiwyg module to add form elements for attributes.
 */
function _ma_gcs_formbuild($type) {
	$key = $type;
	$value = $key.'chart';
	$value = strtolower($value);

	$form['' . $value . '-link'] = array(
		'#name' =&gt; t('link'),
		'#title' =&gt; t(&quot;Enter $key Sheets URL&quot;),
		'#type' =&gt; 'textfield',
		'#states' =&gt; array(
			'visible' =&gt; array(
				':input[name=&quot;shortcode&quot;]' =&gt; array(&quot;value&quot; =&gt; &quot;$value&quot;),
			),
		),
	);

	$form['' . $value . '-worksheet'] = array(
		'#name' =&gt; t('worksheet'),
		'#title' =&gt; t(&quot;Enter $key workheet position&quot;),
		'#description' =&gt; t('This identifies which worksheet to pull data from. Count from the left.'),
		'#type' =&gt; 'textfield',
		'#states' =&gt; array(
			'visible' =&gt; array(
				':input[name=&quot;shortcode&quot;]' =&gt; array(&quot;value&quot; =&gt; &quot;$value&quot;),
			),
		),
	);

	$form['' . $value . '-title'] = array(
			'#name' =&gt; t('title'),
			'#title' =&gt; t(&quot;Enter The $key Chart Title&quot;),
			'#type' =&gt; 'textfield',
			'#size' =&gt; 40,
			'#states' =&gt; array(
					'visible' =&gt; array(
							':input[name=&quot;shortcode&quot;]' =&gt; array('value' =&gt; &quot;$value&quot;),
					),
			),
	);

	$form['' . $value . '-subtitle'] = array(
			'#name' =&gt; t('subtitle'),
			'#title' =&gt; t(&quot;Enter The $key Chart SubTitle&quot;),
			'#type' =&gt; 'textfield',
			'#size' =&gt; 40,
			'#states' =&gt; array(
					'visible' =&gt; array(
							':input[name=&quot;shortcode&quot;]' =&gt; array('value' =&gt; &quot;$value&quot;),
					),
			),
	);
	// To make the fieldset collapsible
	$form['' . $value . '-optionset'] = array(
			'#type' =&gt; 'fieldset',
			'#title' =&gt; t('Chart Options'),
			'#collapsible' =&gt; TRUE, // Added
			'#collapsed' =&gt; FALSE,  // Added
			'#attributes' =&gt; array('class' =&gt; array('optionset')),
			'#states' =&gt; array(
					'visible' =&gt; array(
							':input[name=&quot;shortcode&quot;]' =&gt; array('value' =&gt; &quot;$value&quot;),
					),
			),
	);
	$form['' . $value . '-optionset']['' . $value . '-xtitle'] = array(
		'#name' =&gt; t('xtitle'),
		'#title' =&gt; t(&quot;Enter The X-Axis $key Chart Title&quot;),
		'#type' =&gt; 'textfield',
		'#size' =&gt; 40,
		'#states' =&gt; array(
			'visible' =&gt; array(
				':input[name=&quot;shortcode&quot;]' =&gt; array('value' =&gt; &quot;$value&quot;),
			),
		),
	);

	$form['' . $value . '-optionset']['' . $value . '-ytitle'] = array(
		'#name' =&gt; t('ytitle'),
		'#title' =&gt; t(&quot;Enter The Y-Axis $key Chart Title&quot;),
		'#type' =&gt; 'textfield',
		'#size' =&gt; 40,
		'#states' =&gt; array(
			'visible' =&gt; array(
				':input[name=&quot;shortcode&quot;]' =&gt; array('value' =&gt; &quot;$value&quot;),
			),
		),
	);

	$legend = array(
			'bottom' =&gt; t('On The Bottom'),
			'right' =&gt; t('On The Right')
	);

	$form['' . $value . '-optionset']['' . $value . '-islegend'] = array(
			'#name' =&gt; t('islegend'),
			'#title' =&gt; t('Where would you like the legend to appear?'),
			'#type' =&gt; 'select',
			'#options' =&gt; $legend,
			'#states' =&gt; array(
					'visible' =&gt; array(
							':input[name=&quot;shortcode&quot;]' =&gt; array('value' =&gt; &quot;$value&quot;),
					),
			),
	);


	#For the line and bar charts: option for vertical/horizontal chart (I believe this option will cover the line chart you mentioned and the bar/line charttype can be merged).
	#For the line chart: an independent drop down option with: stacked/unstacked; horizontal/vertical; and filled/unfilled.

	if ($key == &quot;Bar&quot; || $key == &quot;Line&quot;) {
		$stacked = array(
				'True' =&gt; t('Yes'),
				'False' =&gt; t('No')
		);
		$currency = array(
				'True' =&gt; t('Yes'),
				'False' =&gt; t('No')
		);
		$direction = array(
				'Vertical' =&gt; t('Vertical Layout'),
				'Horizontal' =&gt; t('Horizontal Layout')
		);
		$form['' . $value . '-optionset']['' . $value . '-isstacked'] = array(
				'#name' =&gt; t('isstacked'),
				'#title' =&gt; t('Is this a Stacked Chart?'),
				'#type' =&gt; 'select',
				'#options' =&gt; $stacked,
				'#states' =&gt; array(
						'visible' =&gt; array(
								':input[name=&quot;shortcode&quot;]' =&gt; array('value' =&gt; &quot;$value&quot;),
						),
				),
		);
		$form['' . $value . '-optionset']['' . $value . '-isdirection'] = array(
				'#name' =&gt; t('isdirection'),
				'#title' =&gt; t('Which direction does the chart go?'),
				'#type' =&gt; 'select',
				'#options' =&gt; $direction,
				'#states' =&gt; array(
						'visible' =&gt; array(
								':input[name=&quot;shortcode&quot;]' =&gt; array('value' =&gt; &quot;$value&quot;),
						),
				),
		);
		$form['' . $value . '-optionset']['' . $value . '-iscurrency'] = array(
				'#name' =&gt; t('iscurrency'),
				'#title' =&gt; t('Format the y-axis as currency?'),
				'#type' =&gt; 'select',
				'#options' =&gt; $currency,
				'#states' =&gt; array(
						'visible' =&gt; array(
								':input[name=&quot;shortcode&quot;]' =&gt; array('value' =&gt; &quot;$value&quot;),
						),
				),
		);
	}
	if ($key == &quot;Line&quot;) {
		$fillerup = array(
				'True' =&gt; t('Yes'),
				'False' =&gt; t('No')
		);
		$form['' . $value . '-optionset']['' . $value . '-isfilled'] = array(
				'#name' =&gt; t('isfilled'),
				'#title' =&gt; t('Is this a filled chart?'),
				'#type' =&gt; 'select',
				'#description' =&gt; t('This only applies to line charts'),
				'#options' =&gt; $fillerup,
				'#states' =&gt; array(
						'visible' =&gt; array(
								':input[name=&quot;shortcode&quot;]' =&gt; array('value' =&gt; &quot;$value&quot;),
						),
				),
		);
	}
	// To make the fieldset collapsible
	$form['' . $value . '-colorset'] = array(
		'#type' =&gt; 'fieldset',
		'#title' =&gt; t('Colors'),
		'#collapsible' =&gt; TRUE, // Added
		'#collapsed' =&gt; TRUE,  // Added
		'#attributes' =&gt; array('class' =&gt; array('colorset')),
		'#states' =&gt; array(
			'visible' =&gt; array(
				':input[name=&quot;shortcode&quot;]' =&gt; array('value' =&gt; &quot;$value&quot;),
			),
		),
	);

	for($i = 1; $i &lt; 9; $i++) {
		$form ['' . $value . '-colorset']['' . $value . '-col' . $i] = array (
			'#name' =&gt; t('col'.$i),
			'#type' =&gt; 'textfield',
			'#title' =&gt; t('Color #' . $i),
			'#default_value' =&gt; variable_get('ma_gcs_color' . $i, ''),
			'#size' =&gt; 8,
			'#states' =&gt; array(
				'visible' =&gt; array(
					':input[name=&quot;shortcode&quot;]' =&gt; array('value' =&gt; &quot;$value&quot;),
				),
			),
		);
	}

	return $form;
}

function ma_gcs_shortcode_piechart_attributes($form, &amp;$form_state) {
	$pieform = _ma_gcs_formbuild('Pie');
	return $pieform;
}

function ma_gcs_shortcode_linechart_attributes($form, &amp;$form_state) {
	$lineform = _ma_gcs_formbuild('Line');
	return $lineform;
}

function ma_gcs_shortcode_barchart_attributes($form, &amp;$form_state) {
	$barform = _ma_gcs_formbuild('Bar');
	return $barform;
}

function ma_gcs_shortcode_tablechart_attributes($form, &amp;$form_state) {
	$tableform = _ma_gcs_formbuild('Table');
	return $tableform;
}

/**
 * Define our variables (parameters) for each shortcode
 */
function _ma_gcs_base_variables() {
  return array(
  	'type' =&gt; '',
    'link' =&gt; '',
  	'worksheet' =&gt; '',
		'title' =&gt; '',
  	'subtitle' =&gt; '',
    'xtitle' =&gt; '',
    'ytitle' =&gt; '',
  	'islegend' =&gt; '',
  	'isdirection' =&gt; '',
  	'isstacked' =&gt; '',
  	'isfilled' =&gt; '',
		'iscurrency' =&gt; '',
  	'col1' =&gt; '',
    'col2' =&gt; '',
    'col3' =&gt; '',
    'col4' =&gt; '',
    'col5' =&gt; '',
    'col6' =&gt; '',
    'col7' =&gt; '',
    'col8' =&gt; '',
  );
}

function ma_gcs_theme() {
	$array = array(
		'shortcode_piechart' =&gt; array (
			'variables' =&gt; _ma_gcs_base_variables()
		),
		'shortcode_barchart' =&gt; array (
			'variables' =&gt; _ma_gcs_base_variables()
		),
		'shortcode_linechart' =&gt; array (
			'variables' =&gt; _ma_gcs_base_variables()
		),
		'shortcode_tablechart' =&gt; array (
			'variables' =&gt; _ma_gcs_base_variables()
		),
	);
 	return $array;
}

function _ma_gcs_shortcode($attrs) {
	$attrs = shortcode_attrs( _ma_gcs_base_variables(),$attrs);
	$attributearray = array();
	foreach ($attrs as $key =&gt; $value) {
		$attributearray += array(&quot;$key&quot; =&gt; &quot;$value&quot;);
	}
	return $attributearray;
}

function ma_gcs_shortcode_piechart($attrs) {
	$attributearray = _ma_gcs_shortcode($attrs);
 	$attributearray['type'] = &quot;piechart&quot;;
 	return theme ( 'shortcode_piechart', $attributearray );
}

function ma_gcs_shortcode_linechart($attrs) {
	$attributearray = _ma_gcs_shortcode($attrs);
	$attributearray['type'] = &quot;linechart&quot;;
	return theme ( 'shortcode_linechart', $attributearray );
}

function ma_gcs_shortcode_barchart($attrs) {
	$attributearray = _ma_gcs_shortcode($attrs);
	$attributearray['type'] = &quot;barchart&quot;;
	return theme ( 'shortcode_barchart', $attributearray );
}

function ma_gcs_shortcode_tablechart($attrs) {
	$attributearray = _ma_gcs_shortcode($attrs);
	$attributearray['type'] = &quot;tablechart&quot;;
	return theme ( 'shortcode_tablechart', $attributearray );
}

/**
 * This function uses the attributes passed in to return the HTML of this shortcode.
 */

function _ma_gcs_shortcode_theme($vars) {
	$link = $vars['link'];
	$title = $vars['title'];
	$subtitle = $vars['subtitle'];
	$newurl = array();
		$linkparts = explode('/', rtrim($link, '/'));
	$newurl = array();
	if(($linkparts[0] != &quot;http:&quot;) &amp;&amp; ($linkparts[0] != &quot;https:&quot;)) {
		$newurl = explode('/', rtrim(&quot;https://$link&quot;, '/'));
	}
	else {
		$newurl = explode('/', rtrim($link, '/'));
	}
	$chartID = $newurl[5];
	$newlinkparts = explode('=', rtrim($link, '='));
	$gid = '';
	//if(($newlinkparts[0] = &quot;http:&quot;) || ($newlinkparts[0] = &quot;https:&quot;)) {
		$gid = $vars['worksheet'];
	//}

	$thisisrandom = generateRandomString ();
	$returnstring = '';
	if($title) {
	$returnstring .= '&lt;div class=&quot;shortcodetitle&quot;&gt;' . $title . '&lt;/div&gt;';
	}
	if($subtitle) {
		$returnstring .= '&lt;div class=&quot;shortcodesubtitle&quot;&gt;' . $subtitle . '&lt;/div&gt;';
	}
	$returnstring .= '&lt;div class=&quot;shortcodes&quot;';
	$returnstring .= ' id=&quot;' . $thisisrandom . '&quot;';
	$returnstring .= ' data-chartid=&quot;' . $chartID . '&quot;';
	$returnstring .= ' data-gid=&quot;' . $gid . '&quot;';
	$returnstring .= ' data-id=&quot;' . $thisisrandom . '&quot;';
	foreach ($vars as $key =&gt; $value) {
		if(($key != 'link') || ($key != 'title') || ($key != 'subtitle')) {
			$returnstring .= ' data-' . $key . '=&quot;' . $value . '&quot;';
		}
	}
	$returnstring .= '&quot;&gt;&lt;/div&gt;';
	return $returnstring;
}

function theme_shortcode_piechart($vars) {

	$returnstring = _ma_gcs_shortcode_theme($vars);
	return $returnstring;
}

function theme_shortcode_barchart($vars) {
	$returnstring = _ma_gcs_shortcode_theme($vars);
	return $returnstring;
}

function theme_shortcode_linechart($vars) {
	$returnstring = _ma_gcs_shortcode_theme($vars);
	return $returnstring;
}

function theme_shortcode_tablechart($vars) {
	$returnstring = _ma_gcs_shortcode_theme($vars);
	return $returnstring;
}
/**
 * This function outputs some tips to the user beneath the WYSIWYG editor so they know
 * what the shortcode does and how to use it.
 */
function _ma_gcs_shortcode_tip($type, $format, $long) {
	$output = array();
	$output[] = '&lt;p&gt;&lt;strong&gt;' . t('[' . $type . 'Type link=&quot;http://URLhere.com&quot;][/' . $type . 'Type]') . '&lt;/strong&gt; ';
	if ($long) {
		$output[] = t('Outputs a link that is displayed as a chart.') . '&lt;/p&gt;';
	}
	else {
		$output[] = t('Outputs text that links to a URL.') . '&lt;/p&gt;';
	}

	return implode(' ', $output);
}
function ma_gcs_shortcode_piechart_tip($format, $long) {
	$type = &quot;Pie&quot;;
	$format = $format;
	$long = $long;
	return _ma_gcs_shortcode_tip($type, $format, $long);
}
function ma_gcs_shortcode_tablechart_tip($format, $long) {
	$type = &quot;Table&quot;;
	$format = $format;
	$long = $long;
	return _ma_gcs_shortcode_tip($type, $format, $long);
}
function ma_gcs_shortcode_barchart_tip($format, $long) {
	$type = &quot;Bar&quot;;
	$format = $format;
	$long = $long;
	return _ma_gcs_shortcode_tip($type, $format, $long);
}
function ma_gcs_shortcode_linechart_tip($format, $long) {
	$type = &quot;Line&quot;;
	$format = $format;
	$long = $long;
	return _ma_gcs_shortcode_tip($type, $format, $long);
}
/**
 * This function generates a ranomd string to assign as a div id for the google chart (in case they have more than one on a page).
 */
function generateRandomString($length = 5) {
  return substr(str_shuffle(&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;), 0, $length);
}
</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>